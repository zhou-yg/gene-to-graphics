{"version":3,"sources":["G.js"],"names":["categoryGraphics","normalizeGraphics","G","constructor","initial","type","attrs","genes","getAttrs","attrKeys","Object","keys","map","k","gene","Array","isArray","geneArr","v","i","express","reduce","p","c","assign","output","Polygon","name","pointers","fill","Rect","x","y","w","h","Circle","r","graphicsList","categoryMap","other","eye","head","horn","obj","category","list","push","values","graphicsData","initShowData","d","originData","prop","geneName","filter","gen","_","concat","id","_id","nameText","decodeURIComponent","showData"],"mappings":"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","file":"G.map","sourceRoot":"../src/lib","sourcesContent":["export class G {\n  constructor (initial) {\n    this.type = initial.type || '';\n    this.attrs = initial.attrs || {};\n    this.genes = initial.genes || {};\n  }\n  getAttrs () {\n    const attrKeys = Object.keys(this.attrs);\n    return attrKeys.map(k => {\n      const gene = this.genes[k];\n\n      if (Array.isArray(this.attrs[k])) {\n        let geneArr = gene || [];\n        return {\n          [k]: this.attrs[k].map((v, i) => {\n            return geneArr[i] ? (geneArr[i].express || 0) : v;\n          }),\n        };\n      }\n      return {\n        [k]: gene ? gene.express ? gene.express : 0 : this.attrs[k],\n      }\n    }).reduce((p, c) => Object.assign(p, c), {});\n  }\n  output () {\n    return {\n      type: this.type,\n      ...this.getAttrs(),\n    }\n  }\n}\n\nexport class Polygon extends G {\n  constructor (initial = {}) {\n    super(initial);\n    this.type = Polygon.name;\n    if (!initial.attrs) {\n      this.attrs = {\n        pointers: [20, 20, 100, 20, 100, 100, 20, 20],\n        fill: '#000000',\n      }\n    }\n  }\n}\n\nexport class Rect extends G {\n  constructor (initial = {}) {\n    super(initial);\n    this.type = Rect.name;\n    if (!initial.attrs) {\n      this.attrs = {\n        x: 20,\n        y: 20,\n        w: 80,\n        h: 50,\n        fill: '#000000',\n      };\n    }\n  }\n}\n\nexport class Circle extends G {\n  constructor (initial = {}) {\n    super(initial);\n    this.type = Circle.name;\n    if (!initial.attrs) {\n      this.attrs = {\n        x: 100,\n        y: 100,\n        r: 30,\n        fill: '#000000',\n      };\n    }\n  }\n}\n\nexport function categoryGraphics (graphicsList) {\n  var r = {};\n  const categoryMap = {\n    other: '其它',\n    eye: '眼',\n    head: '头',\n    horn: '角',\n  };\n  graphicsList.map(obj => {\n    var category = obj.category;\n    if (!category) {\n      category = 'other';\n    }\n    if (!categoryMap[category]) {\n      // throw new Error(`${category} not found map`);\n    }\n    if (!r[category]) {\n      r[category] = {\n        category,\n        name: categoryMap[category] || 'other',\n        graphicsList: [],\n      }\n    }\n    var list = r[category];\n    list.graphicsList.push(obj);\n  });\n  r = Object.values(r);\n\n  return r;\n}\nexport function normalizeGraphics (graphicsData, genes) {\n\n\n  function initShowData (d) {\n    return d.map(originData => {\n      originData = {\n        ...originData,\n        genes: Object.keys(originData.genes).map(prop => {\n          const geneName = originData.genes[prop]\n\n          if (!geneName) {\n            return {};\n          }\n          return {\n            [prop]: genes.filter(gen => gen.name === prop)[0],\n          }\n        }).reduce((p, c) => Object.assign(p, c), {}),\n      }\n\n      switch (originData.type) {\n        case Rect.name:\n          return new Rect(originData);\n        case Circle.name:\n          return new Circle(originData);\n        case Polygon.name:\n          return new Polygon(originData);\n      }\n    }).filter(_ => _);\n  }\n\n  const graphicsList = [].concat(graphicsData).map(obj => ({\n    ...obj,\n    id: obj._id,\n    nameText: decodeURIComponent(obj.name),\n    showData: initShowData(obj.showData || []),\n  }));\n\n  return graphicsList;\n}\n//\n// module.exports = {\n//   normalizeGraphics,\n//   G,\n//   Polygon,\n//   Rect,\n//   Circle,\n// };\n"]}